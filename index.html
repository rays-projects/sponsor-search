<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>スポンサー検索サイト（β）</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f8f8f8;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input, select {
      padding: 8px;
      font-size: 15px;
      width: 100%;
    }

    button {
      padding: 8px 15px;
      background: #0078ff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #005ec7;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: white;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }
  </style>
</head>

<body>

  <h1>スポンサー検索サイト（β）</h1>

  <div class="search-box">
    <input type="text" id="keyword" placeholder="キーワード検索">
    <select id="category">
      <option value="">すべてのカテゴリー</option>
      <option value="IT">IT</option>
      <option value="食品">食品</option>
      <option value="エンタメ">エンタメ</option>
    </select>
    <button onclick="search()">検索</button>
  </div>

  <ul id="result"></ul>

  <script>
    async function loadSponsors() {
      try {
        const res = await fetch("./data/sponsors.json");
        if (!res.ok) {
          throw new Error("JSON の読み込みに失敗しました");
        }
        const sponsors = await res.json();
        return sponsors;
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    async function search() {
      const kw = document.getElementById("keyword").value;
      const selectedCategory = document.getElementById("category").value;
      const sponsors = await loadSponsors();

      const result = sponsors.filter(s => {
        const keywordMatch =
          kw === "" ||
          s.name.includes(kw) ||
          s.category.includes(kw) ||
          s.location.includes(kw) ||
          s.note.includes(kw);

        const categoryMatch =
          selectedCategory === "" ||
          s.category === selectedCategory;

        return keywordMatch && categoryMatch;
      });

      document.getElementById("result").innerHTML =
        result.length === 0
          ? "<li>該当なし</li>"
          : result.map(r =>
              `<li>
                <strong>${r.name}</strong><br>
                カテゴリ：${r.category}<br>
                地域：${r.location}<br>
                メモ：${r.note}
              </li>`
            ).join("");
    }

    // ページ読み込み時に自動表示
    search();
  </script>

</body>
</html>