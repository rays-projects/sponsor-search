<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Çπ„Éù„É≥„Çµ„ÉºÊ§úÁ¥¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 16px;
      transition: background .2s, color .2s;
    }

    body.dark {
      background: #0f172a;
      color: #e5e7eb;
    }

    h1 {
      margin-top: 0;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .controls, .results {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
    }

    body.dark .controls,
    body.dark .results {
      background: #1e293b;
      box-shadow: none;
    }

    /* ===== „Çπ„Éù„É≥„Çµ„Éº„Çø„Ç∞ ===== */
    .tags span {
      display: inline-block;
      background: #e0e7ff;
      color: #1e3a8a;
      padding: 4px 8px;
      margin: 4px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: transform .12s ease, background .15s ease;
    }

    .tags span:hover {
      transform: scale(0.98);
    }

    /* „É©„Ç§„Éà„É¢„Éº„Éâ active */
    .tags span.active {
      background: #2563eb;
      color: #ffffff;
    }

    /* „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ ÈÄöÂ∏∏ */
    body.dark .tags span {
      background: #334155;
      color: #e5e7eb;
    }

    /* „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ activeÔºàÈáçË¶ÅÔºâ */
    body.dark .tags span.active {
      background: #3b82f6;
      color: #ffffff;
    }

    .selected {
      margin-top: 8px;
      font-size: 14px;
    }

    /* ===== Ê§úÁ¥¢ÁµêÊûú ===== */
    .program {
      padding: 12px 0;
      border-bottom: 1px solid #ddd;
    }

    body.dark .program {
      border-color: #334155;
    }

    .match {
      margin-top: 4px;
      font-size: 13px;
      color: #2563eb;
    }

    body.dark .match {
      color: #93c5fd;
    }

    a {
      color: #2563eb;
      text-decoration: none;
    }

    body.dark a {
      color: #93c5fd;
    }

    /* ===== „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàáÊõø ===== */
    .theme-btn {
      position: fixed;
      top: 16px;
      right: 16px;
      padding: 6px 10px;
      font-size: 13px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }

    body.dark .theme-btn {
      background: #1e293b;
      color: #e5e7eb;
      border-color: #334155;
    }
  </style>
</head>
<body>

<button id="themeToggle" class="theme-btn">üåô „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ</button>

<div class="container">
  <h1>„Çπ„Éù„É≥„Çµ„ÉºÊ§úÁ¥¢</h1>

  <div class="controls">
    <h3>„Çπ„Éù„É≥„Çµ„Éº„Çø„Ç∞Ê§úÁ¥¢</h3>
    <div id="tagArea" class="tags"></div>
    <div id="selectedInfo" class="selected"></div>
  </div>

  <div id="results" class="results"></div>
</div>

<script>
  /* ===== „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ ===== */
  const toggleBtn = document.getElementById("themeToggle");
  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark");
    toggleBtn.textContent = "‚òÄÔ∏è „É©„Ç§„Éà„É¢„Éº„Éâ";
  }

  toggleBtn.onclick = () => {
    document.body.classList.toggle("dark");
    const dark = document.body.classList.contains("dark");
    localStorage.setItem("theme", dark ? "dark" : "light");
    toggleBtn.textContent = dark ? "‚òÄÔ∏è „É©„Ç§„Éà„É¢„Éº„Éâ" : "üåô „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ";
  };

  /* ===== Áä∂ÊÖã ===== */
  let allData = [];
  let selectedSponsors = [];

  /* ===== URLÊìç‰Ωú ===== */
  function updateURL() {
    const params = new URLSearchParams();
    if (selectedSponsors.length) {
      params.set("sponsor", selectedSponsors.join(","));
    }
    history.replaceState(null, "", `?${params.toString()}`);
  }

  function restoreFromURL() {
    const params = new URLSearchParams(location.search);
    const s = params.get("sponsor");
    if (s) selectedSponsors = s.split(",");
  }

  /* ===== „Éá„Éº„ÇøÂèñÂæó ===== */
  async function loadData() {
    const res = await fetch("./data/sponsors.json");
    allData = await res.json();
  }

  /* ===== „Çø„Ç∞ÁîüÊàê ===== */
  function renderTags() {
    const tagArea = document.getElementById("tagArea");
    const sponsors = [...new Set(
      allData.flatMap(p => [p.sponsor1, p.sponsor2, p.sponsor3])
        .filter(s => s && s !== "-")
    )];

    tagArea.innerHTML = "";

    sponsors.forEach(name => {
      const span = document.createElement("span");
      span.textContent = name;
      if (selectedSponsors.includes(name)) span.classList.add("active");

      span.onclick = () => {
        selectedSponsors = selectedSponsors.includes(name)
          ? selectedSponsors.filter(s => s !== name)
          : [...selectedSponsors, name];

        updateURL();
        renderTags();
        renderResults();
      };

      tagArea.appendChild(span);
    });

    document.getElementById("selectedInfo").textContent =
      selectedSponsors.length
        ? `ÈÅ∏Êäû‰∏≠„Çπ„Éù„É≥„Çµ„ÉºÔºö${selectedSponsors.join(" / ")}`
        : "„Çπ„Éù„É≥„Çµ„ÉºÊú™ÈÅ∏Êäû";
  }

  /* ===== ÁµêÊûúÊèèÁîª ===== */
  function renderResults() {
    const area = document.getElementById("results");
    let filtered = allData;

    if (selectedSponsors.length) {
      filtered = allData.filter(p =>
        selectedSponsors.some(s =>
          [p.sponsor1, p.sponsor2, p.sponsor3].includes(s)
        )
      );
    }

    if (!filtered.length) {
      area.innerHTML = "<p>Ë©≤ÂΩì„Åô„ÇãÁï™ÁµÑ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>";
      return;
    }

    area.innerHTML = filtered.map(p => {
      const sponsors = [p.sponsor1, p.sponsor2, p.sponsor3]
        .filter(s => s && s !== "-");
      const matched = sponsors.filter(s => selectedSponsors.includes(s));

      return `
        <div class="program">
          <strong>
            <a href="program.html?id=${p.id}">${p.program}</a>
          </strong><br>
          ${p.station} / ${p.day} ${p.time}
          ${matched.length ? `
            <div class="match">
              ‰∏ÄËá¥„Çπ„Éù„É≥„Çµ„ÉºÔºö${matched.join(" / ")}
            </div>
          ` : ""}
        </div>
      `;
    }).join("");
  }

  /* ===== ÂàùÊúüÂåñ ===== */
  (async () => {
    restoreFromURL();
    await loadData();
    renderTags();
    renderResults();
  })();
</script>

</body>
</html>